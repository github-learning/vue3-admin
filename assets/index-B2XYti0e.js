import{d as j,r as V,h as se,o as x,c as B,b as e,w as o,u as l,f as k,n as ne,F as ue,p as re,i as ie,j as A,E as L,q as de,k as R,s as me,v as pe,x as ce,e as S,l as _e,g as fe}from"./index-5fs_ISJR.js";import{E as ge,e as O,f as P,u as be,a as ve,b as Ve,c as ke,d as Ue}from"./role-BW-O0_4B.js";import{E as Q,a as G}from"./el-form-item-CrQOoRp6.js";const ye={class:"editor-container","p-20px":""},ze=j({__name:"editorUser",props:{type:{type:Number,required:!0},data:{type:Object}},emits:["submit"],setup(D,{emit:_}){const U=D,F=_,f=V(null),a=V({username:"test333",mobile:"666666666666",email:"11@qq.com",description:"34",status:!0}),g={username:{required:!0,message:"请输入用户名",trigger:"blur"},email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}],mobile:[{required:!0,message:"请输入手机",trigger:"blur"},{message:"请输入正确11位手机号",trigger:"blur",validator:(s,n,p)=>{!isNaN(Number(n))&&n.length===11&&p(),p(new Error("请输入正确格式手机号!"))}}],roleIds:{required:!0,message:"请至少选择一个角色！",trigger:"blur"}},q={username:"",email:"",mobile:"",description:"",status:!0};se(()=>{var s;U.data&&((s=f.value)==null||s.clearValidate(),a.value={...q,...U.data})});const w=()=>{f.value.validate(s=>{s&&F("submit",a.value)})};return(s,n)=>{const p=A,c=Q,I=ge,$=O,d=P,h=L,y=G;return x(),B("div",ye,[e(y,{ref_key:"editFormRef",ref:f,model:l(a),rules:g,"label-width":"80px"},{default:o(()=>[e(c,{label:"用户名",prop:"username"},{default:o(()=>[e(p,{modelValue:l(a).username,"onUpdate:modelValue":n[0]||(n[0]=u=>l(a).username=u),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),e(c,{label:"手机",prop:"mobile"},{default:o(()=>[e(p,{modelValue:l(a).mobile,"onUpdate:modelValue":n[1]||(n[1]=u=>l(a).mobile=u),placeholder:"请输入手机",maxlength:"11"},null,8,["modelValue"])]),_:1}),e(c,{label:"邮箱",prop:"email"},{default:o(()=>[e(p,{modelValue:l(a).email,"onUpdate:modelValue":n[2]||(n[2]=u=>l(a).email=u),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),e(c,{label:"状态",prop:"status"},{default:o(()=>[e(I,{modelValue:l(a).status,"onUpdate:modelValue":n[3]||(n[3]=u=>l(a).status=u)},null,8,["modelValue"])]),_:1}),e(c,{label:"角色分配",prop:"roleIds"},{default:o(()=>[k(ne(l(a).roleIds)+" ",1),e(d,{multiple:"",modelValue:l(a).roleIds,"onUpdate:modelValue":n[4]||(n[4]=u=>l(a).roleIds=u),placeholder:"请选择角色"},{default:o(()=>[(x(!0),B(ue,null,re(l(a).roles,u=>(x(),ie($,{key:u.id,label:u.name,value:u.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"说明",prop:"description"},{default:o(()=>[e(p,{type:"textarea",rows:3,modelValue:l(a).description,"onUpdate:modelValue":n[5]||(n[5]=u=>l(a).description=u),placeholder:"请输入说明"},null,8,["modelValue"])]),_:1}),e(c,null,{default:o(()=>[e(h,{type:"primary",onClick:w},{default:o(()=>n[6]||(n[6]=[k("提交")])),_:1})]),_:1})]),_:1},8,["model"])])}}}),Ce={class:"user-container","p-30px":""},Ee={class:"user-list"},Se={class:"user-container"},Fe={class:"user-list"},Ne={class:"user-pagination"},we=j({__name:"index",setup(D){const _=de(),U=be(),F=R(()=>_.state.users);console.log("%c [ users ]-90","font-size:13px; background:pink; color:#bf2c9f;",F);const f=R(()=>U.state.roles);console.log("%c [ roles ]-184","font-size:13px; background:pink; color:#bf2c9f;",f.value);const a=V(1),m=V(10),g=()=>{_.getAllUsers({pageNum:a.value,pageSize:m.value,...d})},q=()=>{U.getRoles({pageNum:a.value,pageSize:m.value})},w=r=>r.status?"正常":"禁用";me(()=>{g(),q()});const{proxy:s}=fe(),n=async r=>{try{await(s==null?void 0:s.$confirm(`您确认要删除用户${r.username}吗？`,"删除确认",{type:"warning"})),await _.removeUser({id:r.id,pageNum:a.value,pageSize:m.value}),s==null||s.$message.success("用户删除成功")}catch{s==null||s.$message({type:"info",message:"已取消删除"})}},p=(r,t)=>{C.value=0,b.value={...t},console.log("%c [  ]-134","font-size:13px; background:pink; color:#bf2c9f;",t),b.value.roleIds=t==null?void 0:t.roleIds,b.value.roles=f.value,v.value=!0},c=R(()=>_.state.total),I=r=>{m.value=r,g()},$=r=>{a.value=r-1,g()},d=pe({username:"",status:"all",mobile:""}),h=()=>{g()},y=ce("queryFormRef"),u=()=>{y.value.resetFields(),g()},b=V(void 0),v=V(!1),C=V(1),H=R(()=>C.value===1?"新增用户":"编辑用户");U.getRoles({pageNum:a.value,pageSize:m.value});const J=()=>{C.value=1,b.value={},b.value.roles=f.value,b.value.roleIds=[],v.value=!0},K=async r=>{_.editUser({...r,pageSize:m.value,pageNum:a.value}),y.value.resetFields(),s==null||s.$message.success("用户编辑成功"),v.value=!1},W=r=>{C.value===1?X(r):K(r)},X=r=>{_.addUser({...r,pageSize:m.value,pageNum:a.value}),y.value.resetFields(),s==null||s.$message.success("用户添加成功"),v.value=!1};return(r,t)=>{const E=L,M=A,N=Q,T=O,Y=P,Z=G,z=Ue,ee=ve,le=Ve,te=ze,ae=ke;return x(),B("div",Ce,[t[9]||(t[9]=S("h2",null,"用户管理",-1)),e(E,{type:"primary",plain:"",onClick:J},{default:o(()=>t[4]||(t[4]=[k(" 添加用户")])),_:1}),e(Z,{inline:!0,model:l(d),ref_key:"queryFormRef",ref:y},{default:o(()=>[e(N,{label:"用户名",prop:"username"},{default:o(()=>[e(M,{modelValue:l(d).username,"onUpdate:modelValue":t[0]||(t[0]=i=>l(d).username=i),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),e(N,{label:"手机号",prop:"mobile"},{default:o(()=>[e(M,{modelValue:l(d).mobile,"onUpdate:modelValue":t[1]||(t[1]=i=>l(d).mobile=i),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),e(N,{label:"状态",prop:"status","w-200px":""},{default:o(()=>[e(Y,{modelValue:l(d).status,"onUpdate:modelValue":t[2]||(t[2]=i=>l(d).status=i),placeholder:"状态"},{default:o(()=>[e(T,{label:"全部",value:"all"}),e(T,{label:"禁用",value:0}),e(T,{label:"正常",value:1})]),_:1},8,["modelValue"])]),_:1}),e(N,null,{default:o(()=>[e(E,{type:"primary",onClick:h},{default:o(()=>t[5]||(t[5]=[k("查询")])),_:1}),e(E,{type:"default",onClick:u},{default:o(()=>t[6]||(t[6]=[k("重置")])),_:1})]),_:1})]),_:1},8,["model"]),S("div",Ee,[e(ee,{data:l(F),"max-height":"400"},{default:o(()=>[e(z,{prop:"username",label:"用户名"}),e(z,{prop:"mobile",label:"手机"}),e(z,{prop:"email",label:"邮箱"}),e(z,{prop:"status",label:"状态",formatter:w}),e(z,{prop:"createdAt",label:"创建时间"}),e(z,{label:"操作",fixed:"right",width:"150px"},{default:o(i=>[e(E,{size:"small",link:"",onClick:oe=>p(i.$index,i.row)},{default:o(()=>t[7]||(t[7]=[k("编辑")])),_:2},1032,["onClick"]),e(E,{size:"small",link:"",onClick:oe=>n(i.row)},{default:o(()=>t[8]||(t[8]=[k("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),S("div",Se,[S("div",Fe,[S("div",Ne,[e(le,{onSizeChange:I,onCurrentChange:$,background:"",total:l(c),"page-sizes":[1,5,10,20],"page-size":l(m),layout:"total, prev, pager, next, sizes,jumper"},null,8,["total","page-size"])])])])]),e(ae,{modelValue:l(v),"onUpdate:modelValue":t[3]||(t[3]=i=>_e(v)?v.value=i:null),title:l(H),size:330},{default:o(()=>[e(te,{type:l(C),data:l(b),onSubmit:W},null,8,["type","data"])]),_:1},8,["modelValue","title"])])}}});export{we as default};
